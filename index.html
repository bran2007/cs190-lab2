<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>CS190 Lab Web Page</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f8f9fa;
    color: #333;
  }
  #menu {
    margin-bottom: 20px;
  }
  button {
    margin-right: 10px;
    padding: 8px 15px;
    font-size: 14px;
  }
  #mainXXX {
    border: 1px solid #ccc;
    background: white;
    padding: 15px;
    min-height: 300px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  table, td, th {
    border: 1px solid #aaa;
  }
  td, th {
    padding: 8px;
  }
  .cartLinkBar {
    margin-top: 10px;
  }
</style>
</head>
<body>

<h1>CS190 Web Page Lab</h1>

<div id="menu"></div>
<div id="mainXXX">Welcome! Click buttons above to start.</div>

<script>
  // Base image URLs (use real URLs that exist)
  var imgBaseUrl = 'https://www.college1.com/images/'; // product images base URL
  var cardImgBaseUrl = 'https://www.college1.com/images/cards/gbCard'; // cards base URL (assumed pattern)

  // Global variables
  var cardnum580 = -1;
  var hand = [];

  // Hardcoded products
  var product1 = { name:"HP 4426", id:"4426", desc:"Newest and Best Laptop from HP Computer" };
  var product2 = { name:"Apple 88123 iPad", id:"88123", desc:"Apple Tablet Computer" };
  var product3 = { name:"Dell Dimension 2400", id:"2400X", desc:"A fast 2.4 ghz computer" };
  var product4 = {}; // to be fetched
  var product5 = {}; // to be fetched

  // JSON queries for server fetch
  var jsonobj4 = { type:"clothes", number:"1" };
  var jsonobj5 = { type:"dvdcd", number:"2" };

  // Build menu
  function makeMenu() {
    var html = '';
    html += '<button onclick="makeMain(product1)">Product #1</button>';
    html += '<button onclick="makeMain(product2)">Product #2</button>';
    html += '<button onclick="makeMain(product3)">Product #3</button>';
    html += '<button onclick="makeMain(product4)">Product #4</button>';
    html += '<button onclick="makeMain(product5)">Product #5</button>';
    html += '<button onclick="dealCards649()">Deal Cards</button>';
    html += '<button onclick="hitCard896()">Hit Card</button>';
    html += '<button onclick="popupAd835()">PopUp Ad</button>';
    html += '<button onclick="closeAd835()">Close Ad</button>';
    html += '<button onclick="makeForm294()">Enter Data</button>';
    document.getElementById('menu').innerHTML = html;
  }

  // Show product in mainXXX div
  function makeMain(product) {
    cardnum580 = -1;
    hand = [];

    if (!product.name) {
      document.getElementById('mainXXX').innerHTML = "<p>Product info not available yet. Please wait or try again later.</p>";
      return;
    }

    // Build product image URL
    var prodUrl = imgBaseUrl + product.id + '.gif';

    // Build HTML
    var html = '<h2>' + product.name + '</h2>';
    html += "<img src='" + prodUrl + "' alt='" + product.name + "' style='max-width:200px; margin-bottom:10px; display:block;' onerror=\"this.onerror=null;this.src='https://via.placeholder.com/200x150?text=No+Image';\">";
    html += '<p>' + product.desc + '</p>';
    html += makeLinkBar432(product);

    document.getElementById('mainXXX').innerHTML = html;
  }

  // Shopping cart button (Paypal)
  function makeLinkBar432(product) {
    return `
      <div class="cartLinkBar">
        <form target="paypal" action="https://www.paypal.com/cgi-bin/webscr" method="post">
          <input type="hidden" name="business" value="test@yourbusiness.com">
          <input type="hidden" name="cmd" value="_cart">
          <input type="hidden" name="add" value="1">
          <input type="hidden" name="item_name" value="${product.name}">
          <input type="hidden" name="amount" value="9.99">
          <input type="hidden" name="currency_code" value="USD">
          <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_cart_LG.gif" alt="Add to Cart">
        </form>
      </div>
    `;
  }

  // Deal cards function
  function dealCards649() {
    cardnum580 = 2;
    hand = [];

    // Generate 5 unique random cards (0-51)
    while (hand.length < 5) {
      var card = Math.floor(Math.random() * 52);
      if (!hand.includes(card)) hand.push(card);
    }

    var html = "<h3>Blackjack Hand</h3>";
    for (var i = 0; i < 5; i++) {
      var cardUrl = (i < 2) ? (cardImgBaseUrl + hand[i] + ".gif") : (cardImgBaseUrl + "52.gif"); // "52.gif" is back of card
      html += `<img id="card${i}" src="${cardUrl}" alt="Card ${i}" style="margin-right:5px; width:80px; height:120px;">`;
    }
    document.getElementById('mainXXX').innerHTML = html;
  }

  // Hit card function (flip next card face up)
  function hitCard896() {
    if (cardnum580 === -1) {
      alert("Deal the cards first!");
      return;
    }
    if (cardnum580 >= 5) {
      alert("No more cards to hit!");
      return;
    }
    var cardIndex = cardnum580;
    var cardElement = document.getElementById("card" + cardIndex);
    if (!cardElement) {
      alert("Card element not found!");
      return;
    }
    var cardValue = hand[cardIndex];
    cardElement.src = cardImgBaseUrl + cardValue + ".gif";
    cardnum580++;
  }

  // Popup ads
  var adnum899 = 1;
  var winobj412 = null;

  function popupAd835() {
    if (winobj412 && !winobj412.closed) {
      winobj412.focus();
      return;
    }
    var adUrl;
    if (adnum899 === 1) adUrl = 'https://www.college1.com/ads/ad1.html';
    else if (adnum899 === 2) adUrl = 'https://www.college1.com/ads/ad2.html';
    else adUrl = 'https://www.college1.com/ads/ad3.html';

    winobj412 = window.open(adUrl, "PopUpAd", "width=500,height=500");
    adnum899++;
    if (adnum899 > 3) adnum899 = 1;
  }
  function closeAd835() {
    if (winobj412 && !winobj412.closed) winobj412.close();
  }

  // Form creation and validation
  function makeForm294() {
    cardnum580 = -1;
    hand = [];

    var formHTML = `
      <h2>Customer Data Entry</h2>
      <form name="customerform" onsubmit="return checkForm453()" method="post" action="https://www.college1.com/classes/javascript/survey.php">
        <table width="100%" border="1">
          <tr>
            <td>First Name: <input type="text" name="firstname"></td>
            <td align="right">Last Name: <input type="text" name="lastname"></td>
          </tr>
          <tr>
            <td colspan="2">Address: <input type="text" name="address" size="50"></td>
          </tr>
          <tr>
            <td>City: <input type="text" name="city"></td>
            <td align="right">State: <input type="text" name="state" size="3"> Zip: <input type="text" name="zip" size="6"></td>
          </tr>
          <tr>
            <td colspan="2">Email Address: <input type="text" name="emailaddr" size="50"></td>
          </tr>
          <tr>
            <td><input type="submit" value="Submit"></td>
            <td align="right"><input type="reset"></td>
          </tr>
        </table>
        <input type="hidden" name="send_email" value="bwchang@my.canyons.edu">
      </form>
    `;

    document.getElementById('mainXXX').innerHTML = formHTML;
  }

  function checkForm453() {
    var form = document.forms['customerform'];
    var missingFields = [];

    if (!form.firstname.value.trim()) missingFields.push("First Name");
    if (!form.lastname.value.trim()) missingFields.push("Last Name");
    if (!form.address.value.trim()) missingFields.push("Address");
    if (!form.city.value.trim()) missingFields.push("City");
    if (!form.state.value.trim()) missingFields.push("State");
    if (!form.zip.value.trim()) missingFields.push("Zip");
    if (!form.emailaddr.value.trim()) missingFields.push("Email Address");

    if (missingFields.length > 0) {
      alert("Please fill in the following field(s):\n" + missingFields.join(", "));
      return false;
    }
    return true;
  }

  // Fetch products from server
  function getProduct902(jsonobj) {
    var server = 'https://www.college1.com/getproduct.php';
    var jsonstr = JSON.stringify(jsonobj);
    var xmlhttp = new XMLHttpRequest();

    xmlhttp.open("GET", server + "?jsonstr=" + encodeURIComponent(jsonstr), true);
    xmlhttp.onreadystatechange = function() {
      if (this.readyState === 4 && this.status === 200) {
        var obj = JSON.parse(this.responseText);

        if (jsonobj.number === "1") {
          product4 = obj;
        } else if (jsonobj.number === "2") {
          product5 = obj;
        }

        // Refresh display if currently showing product4 or product5
        var mainHTML = document.getElementById('mainXXX').innerHTML;
        if (product4.name && mainHTML.includes(product4.name)) makeMain(product4);
        if (product5.name && mainHTML.includes(product5.name)) makeMain(product5);
      }
    };
    xmlhttp.send();
  }

  // Initialization on load
  window.onload = function() {
    makeMenu();
    makeMain(product1);

    // Empty product4 and product5 initially
    product4 = {};
    product5 = {};

    // Fetch products asynchronously
    getProduct902(jsonobj4);
    getProduct902(jsonobj5);
  };

</script>

</body>
</html>
